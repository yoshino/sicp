; 足し算のて続き抽象化
(define (sum term a next b)
  (if (> a b)
    0
    (+ (term a)
       (sum term (next a) next b))))

; 掛け算の手続き抽象化:再帰プロセス
(define (product term a next b)
  (if (> a b)
    1
    (* (term a)
       (product term (next a) next b))))

(define (inc n) (+ n 1))

(define (identify n) n)identify

; 階乗：factorial
; (factorial 1 5)
; = 1 * 2 * 3 * 4 * 5 = 120
(define (factorial a b)
  (product identify a inc b))

; 問題の関数を定義するために性質を抽象化すると、
; 偶数の時に、 (a + 2) / (a + 1)
; 奇数の時に、 (a + 1) / (a + 2)
; になっていることがわかるので、

(define (wallis a)
  (if (even? a)
    (/ (+ a 2) (+ a 1))
    (/ (+ a 1) (+ a 2))))

(define (pie a b)
  (* (product wallis a inc b) 4))

; gosh> (pie 1 10)
; 524288/160083

; gosh> (pie 1 100)
; 100433627766186892221372630771322662657637687111424552206336/31812691723763485888378604594585078862254431033114177637499
; 3.1570301764551676

; gosh> (pie 1 1000)
; 112122138210376418382112617302508006252179463094599140671644798518141236464098663462564402960596315421723238734276119411469445211021782747209563609000649725135869130024719023438172635886953168819754811513733873285919546351217176136667301783242642923799711910701330467586859989849241515282750160373017903009125164950180135259377323715632728573145444117676200197965533814287619148566636993448985613167301959569331441814577169706892972697421731624269082899837795011641166950960536789100742267536344365803472051196859107437039403111737726615731362574007697876147886258594553557393376919388439633643700224/35671780323872920093242256783724106391676214109362710495132931284619475266689995380379811182045141364247561826266920190587972223494084903483413747749338448707907574393238490904347769439784453553384286897392391073141680922984739974813075471523603928496527005845584613716302329857944878352466698223226459074276384903517742872437285433944823851851199042547526266382952760358997958275725612429767978536100571422632952660793536581461685963671708597531788272085174929572480528901968218697958745133550442527677193277882433164511185066763653386836422659898505865811132514272323372965570755522938956968102525
; 計算できない。。。


; 線形プロセス
(define (product term a next b)
  (if (> a b)
    1
    (* (term a)
       (product term (next a) next b))))

(define (product term a next b)
  (define (iter a result)
    (if (> a b) 
      result
      (iter (next a) (* result (term a)))))
  (iter a 1))

